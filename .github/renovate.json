{
  "extends": ["github>balena-os/renovate-config"],
  "ignorePaths": [
    "**/node_modules/**",
    "**/bower_components/**",
    "**/vendor/**",
    "**/examples/**",
    "**/__tests__/**",
    "**/test/**",
    "**/tests/suites/**",
    "**/__fixtures__/**"
  ],
  "commitBody": "Update {{depName}}\nChange-type: patch",
  "regexManagers": [
    {
      "fileMatch": ["(^|/)balena-supervisor.inc$"],
      "matchStrings": ["SUPERVISOR_VERSION \\?= \"(?<currentValue>.*?)\"\\n"],
      "depNameTemplate": "balena-supervisor",
      "packageNameTemplate": "balena-os/balena-supervisor",
      "datasourceTemplate": "github-tags"
    },
    {
      "fileMatch": ["(^|/)balena_git.bb$"],
      "matchStrings": ["BALENA_VERSION = \"(?<currentValue>.*?)\"\\n"],
      "depNameTemplate": "balena-engine",
      "packageNameTemplate": "balena-os/balena-engine",
      "datasourceTemplate": "github-tags"
    }
  ],
  "packageRules": [
    {
      "matchManagers": ["regex"],
      "matchPackagePatterns": [
        ".*balena-supervisor",
        ".*balena-engine"
      ],
      "commitBody": "Update {{depName}}\nChange-type: {{updateType}}",
      "automerge": true,
      "platformAutomerge": true,
      "postUpgradeTasks": {
        "commands": [
          "sed -r \"s|SRCREV = \\\"[0-9a-f]+\\\"|SRCREV = \\\"$(git ls-remote -t {{{sourceUrl}}} refs/tags/{{{newVersion}}} | awk '{print $1}')\\\"|\" -i {{{packageFile}}}"
        ],
        "fileFilters": [
          "**/balena_git.bb"
        ],
        "executionMode": "update"
      }
    }
  ]
}
